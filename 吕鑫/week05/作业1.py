# 客服工作台FAQ作业：后端与算法开发任务文档

## 后端开发任务

### 1. 数据库设计

**核心表设计建议**：
*   **类目表 (category)**：支持无限级分类。
    *   字段：`id`, `name`, `parent_id` (自关联，0表示一级类目), `level` (层级), `create_time`, `update_time`。
*   **FAQ主表 (faq)**：存储标准问题与答案。
    *   字段：`id`, `category_id` (关联类目表), `title` (标准问法), `answer` (答案),  `status` (生效/失效/待验证...), `create_time`, `update_time`。
*   **相似问法表 (faq_similar_question)**：存储一个FAQ的多个相似问法，用于扩充匹配样本。
    *   字段：`id`, `faq_id`, `question` (相似问题文本), `create_time`。

*   **用户会话日志表 (query_log)**：记录用户query、命中的FAQ、匹配率,用户评价等，用于效果分析与模型迭代。

### 2. API接口设计与实现
需实现API，包括：
*   **类目管理接口**：一级/子级类目的增、删、改、查。
*   **FAQ管理接口**：
    *   导入、导出、删除、转移类目。
    *   FAQ状态更新设置。
*   **核心匹配接口**：`POST /api/faq/match`，参数为`query`（用户的问题），返回最匹配的`faq_id`、`answer`及匹配率。

---

## 算法开发任务


### 2. 如何使用BERT
**使用方式**：**Sentence-BERT**。

**具体实施步骤**：
1.  **离线预处理**：使用`bert-base-chinese`对所有FAQ标题（标准问+相似问）进行向量化。
2.  **向量存储**：将生成的768维向量存入向量数据库。
3.  **在线召回**：将用户query实时向量化，在向量库中进行**近似最近邻（ANN）检索**，找到Top K个最相似的FAQ。
4.  **精排（可选）**：对于找到的Top N结果。

### 3. 是否需要使用大模型
**结论：可作为增强手段。**
*   **基础版本**：Sentence-BERT双塔模型完全够用，且推理速度快、部署成本低。
*   **大模型应用场景**：
    1.  **样本较少时**：当某个类目下FAQ样本极少时，利用大模型（如通义千问）的语义理解能力辅助分类。
    2.  **复杂用户问题**：用户输入过于复杂或者难以理解时，优先使用大模型进行改写，再进行向量检索。
    3.  **无答案检测**：当匹配得分低于阈值时，使用大模型判断是否真的“无答案”还是检索失败。

### 4. 相似度匹配的具体逻辑
*   **样本扩充**：充分利用“相似问法”字段。将用户历史日志中**点击/采纳（用户认可）**的高频Query，反哺回对应FAQ的相似问法池，实现模型自优化。
